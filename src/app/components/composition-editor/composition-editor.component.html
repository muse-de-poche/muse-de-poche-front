<div class="container">
    <div class="row border mt-2 mb-2">
        <div class="col-xl-2">
            Titre
            <h5>{{composition.title}}</h5>
            <i>de {{composition.owner.pseudo}}</i>
        </div>
        <div class="col-xl-5 d-flex justify-content-evenly align-self-center border">
            <fa-icon *ngIf="!playButton" role="button" (click)="play()" [icon]="faPlay" size="4x" ngbTooltip="Jouer"></fa-icon>
            <fa-icon *ngIf="playButton" role="button" (click)="play()" [icon]="faPause" size="4x" ngbTooltip="Pause"></fa-icon>
            <fa-icon role="button" (click)="stop()" [icon]="faStop" size="4x" ngbTooltip="Stop"></fa-icon>
            <fa-icon *ngIf="!isRecording" role="button" (click)="initiateRecording()" [icon]="faCircle" size="4x" ngbTooltip="Enregistrer"></fa-icon>
            <fa-icon *ngIf="isRecording" role="button" (click)="stopRecording()" [icon]="faDotCircle" size="4x" [styles]="{'stroke': 'black','color': 'red'}" ngbTooltip="Stoper l'enregistrement"></fa-icon>
            <fa-icon role="button" [icon]="faStepBackward" size="4x"></fa-icon>
            <fa-icon role="button" (click)="skipBackward()" [icon]="faBackward" size="4x" ngbTooltip="Retour de 10s"></fa-icon>
            <fa-icon role="button" (click)="skipForward()" [icon]="faForward" size="4x" ngbTooltip="Avance de 10s"></fa-icon>
        </div>
        <app-metronome class=" col-xl-2 d-inline-block justify-content-evenly align-self-center" [metronome]="composition.metronome"></app-metronome>
        <div class="col-xl-1 d-inline-block justify-content-evenly align-self-center">
            <button type="button" class="btn btn-secondary" [disabled]="!isCurOwner()" ngbTooltip="Réglages audio" (click)="openLg(reglages)"><fa-icon [icon]="faTools" size="2x"></fa-icon></button>
        </div>
        <div class="col-xl-1 justify-content-evenly align-self-center">
            <button type="button" class="btn btn-secondary" [disabled]="!isCurOwner()" ngbTooltip="Groupe" (click)="openLg(workgroup)"><fa-icon [icon]="faUsers" size="2x"></fa-icon></button>
        </div>
        <div class="col-xl-1 justify-content-evenly align-self-center">
            <button type="button" class="btn btn-warning" [disabled]="!isCurOwner()" ngbTooltip="publier mix" (click)="mergeMix()"><fa-icon [icon]="faBlender" size="2x"></fa-icon></button>

        </div>
    </div>
    <div class="row">
        <!-- Regle -->
        <!-- Sounds -->
        <ng-template ngFor let-track [ngForOf]="composition.tracks" let-i="index">
            <div (click)="setCurTrack(track)" class="col-xl-1 border" [ngClass]="(curTrack.id === track.id) ? 'bg-light border border-primary': '' ">
                <div>{{track.instrument}}</div>
                <button class="btn btn-danger" ngbTooltip="supprimer le son" (click)="deleteSound(track)">X</button>
            </div>
            <div class="col-xl-11 border" [ngClass]="(curTrack.id === track.id) ? 'bg-light border border-primary': '' ">
                <ng-template ngFor let-sound [ngForOf]="track.sounds" let-j="index">
                    <app-sound [context]="context" [sound]="sound"></app-sound>
                </ng-template>
            </div>
        </ng-template>
    </div>
    <div>
        <fa-icon class="btn btn-success" (click)="newTrack()" [icon]="faPlus" size="4x"></fa-icon>
    </div>
</div>

<ng-template #workgroup let-modal>
    <app-workgroup [composition]="composition"></app-workgroup>
</ng-template>

<ng-template #reglages let-modal>
    <div class="container">
        <div class="modal-header"> Réglages </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="reglages">Echantillonnage</label>
                <input type="number" name="reglages" id="reglages" value="sampleRate" [(ngModel)]="sampleRate">
            </div>
            <div class="form-group">
                <label for="buffer">taille du buffer</label>
                <select class="form-control" name="buffer" id="buffer" [(ngModel)]="bufferSize">
                        <option value="256">256</option>
                        <option value="512">512</option>
                        <option value="1024">1024</option>
                        <option value="2048">2048</option>
                        <option value="4096">4096</option>
                        <option value="8192">8192</option>
                        <option value="16384" selected>16384</option>
                    </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" (click)="setReglages()">Valider</button>
            </div>
        </div>

    </div>
</ng-template>